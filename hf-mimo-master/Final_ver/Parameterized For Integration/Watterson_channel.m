% Create the Watterson channel to run a signal through. Does not perform
% transmission or add AWGN. 
% parameters:
%   - nTx = number of transmit antennas
%   - nRx  = number of receive antennas
%   - fd = max doppler shift
%   - sGauss = standard deviations for doppler components
%   - fGauss = normalized centered frequencies for doppler components
%   - Rs = sample rate

%default call: Watterson_channel(nTx, nRx, 1, 0.2, 0.1, -0.5, 0.4, 9600)
function [chanComp1, chanComp2] = Watterson_channel(nTx, nRx, fd, sGauss1, sGauss2, fGauss1, fGauss2, Rs)

dopplerComp1 = doppler('BiGaussian', ...
    'NormalizedStandardDeviations', [sGauss1/fd 1/sqrt(2)], ...
    'NormalizedCenterFrequencies',  [fGauss1/fd 0], ...
    'PowerGains',                   [0.5        0]);
chanComp1 = comm.MIMOChannel( ...
    'SampleRate',          Rs, ...
    'MaximumDopplerShift', fd, ...
    'DopplerSpectrum',     dopplerComp1, ...
    'RandomStream',        'mt19937ar with seed', ...
    'Seed',                99, ...
    'PathGainsOutputPort', true,...
    'NumTransmitAntennas', nTx,...
    'NumReceiveAntennas', nRx,...
    'SpatialCorrelationSpecification', 'None' );

dopplerComp2 = doppler('BiGaussian', ...
    'NormalizedStandardDeviations', [sGauss2/fd 1/sqrt(2)], ...
    'NormalizedCenterFrequencies',  [fGauss2/fd 0], ...
    'PowerGains',                   [0.5        0]);
chanComp2 = comm.MIMOChannel( ...
    'SampleRate',          Rs, ...
    'MaximumDopplerShift', fd, ...
    'DopplerSpectrum',     dopplerComp2, ...
    'RandomStream',        'mt19937ar with seed', ...
    'Seed',                999, ...
    'PathGainsOutputPort', true,...
    'NumTransmitAntennas', nTx,...
    'NumReceiveAntennas', nRx,...
    'SpatialCorrelationSpecification', 'None');
end